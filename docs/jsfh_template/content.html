{#
    Content template for json-schema-for-humans
    awesIO Schema Documentation
    
    This template renders the schema properties and nested structures.
    It provides expand/collapse functionality and anchor links for navigation.
#}

{% macro render_property(name, prop, required=false, depth=0) %}
<div class="property" id="prop-{{ name | replace('.', '-') }}" style="margin-left: {{ depth * 20 }}px;">
    <div class="property-header">
        <span class="property-name">{{ name }}</span>
        {% if prop.type %}
        <span class="property-type">{{ prop.type }}</span>
        {% endif %}
        {% if required %}
        <span class="required-badge">required</span>
        {% else %}
        <span class="optional-badge">optional</span>
        {% endif %}
        <a href="#prop-{{ name | replace('.', '-') }}" class="anchor-link">#</a>
    </div>
    
    {% if prop.description %}
    <div class="description">{{ prop.description }}</div>
    {% endif %}
    
    {# Constraints #}
    {% if prop.minimum is defined or prop.maximum is defined or prop.enum or prop.pattern %}
    <div class="constraints">
        {% if prop.minimum is defined %}
        <span class="constraint">min: {{ prop.minimum }}</span>
        {% endif %}
        {% if prop.maximum is defined %}
        <span class="constraint">max: {{ prop.maximum }}</span>
        {% endif %}
        {% if prop.enum %}
        <span class="constraint">enum: {{ prop.enum | join(', ') }}</span>
        {% endif %}
        {% if prop.pattern %}
        <span class="constraint">pattern: {{ prop.pattern }}</span>
        {% endif %}
        {% if prop.default is defined %}
        <span class="constraint">default: {{ prop.default }}</span>
        {% endif %}
    </div>
    {% endif %}
    
    {# Examples #}
    {% if prop.examples %}
    <div class="example">
        <div class="example-label">Example:</div>
        <code>{{ prop.examples[0] }}</code>
    </div>
    {% endif %}
    
    {# Nested properties for objects #}
    {% if prop.type == 'object' and prop.properties %}
    <div class="expandable">Nested Properties</div>
    <div class="expandable-content">
        {% for child_name, child_prop in prop.properties.items() %}
        {{ render_property(name + '.' + child_name, child_prop, child_name in (prop.required or []), depth + 1) }}
        {% endfor %}
    </div>
    {% endif %}
    
    {# Array items #}
    {% if prop.type == 'array' and prop.items %}
    <div class="expandable">Array Items</div>
    <div class="expandable-content">
        {% if prop.items.type == 'object' and prop.items.properties %}
        {% for child_name, child_prop in prop.items.properties.items() %}
        {{ render_property(name + '[].' + child_name, child_prop, child_name in (prop.items.required or []), depth + 1) }}
        {% endfor %}
        {% else %}
        <div class="property" style="margin-left: {{ (depth + 1) * 20 }}px;">
            <span class="property-type">{{ prop.items.type or 'any' }}</span>
            {% if prop.items.description %}
            <div class="description">{{ prop.items.description }}</div>
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endmacro %}

{# Table of Contents #}
{% if schema.properties %}
<div class="toc">
    <h3>Contents</h3>
    <ul>
        {% for name, prop in schema.properties.items() %}
        <li>
            <a href="#prop-{{ name }}">{{ name }}</a>
            {% if name in (schema.required or []) %}<span class="required-badge">required</span>{% endif %}
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

{# Schema Info #}
{% if schema.get('$id') %}
<p><strong>Schema ID:</strong> <code>{{ schema['$id'] }}</code></p>
{% endif %}

{% if schema.get('$schema') %}
<p><strong>JSON Schema Version:</strong> <code>{{ schema['$schema'] }}</code></p>
{% endif %}

{# Required Fields Summary #}
{% if schema.required %}
<h2>Required Fields</h2>
<ul>
    {% for req in schema.required %}
    <li><a href="#prop-{{ req }}"><code>{{ req }}</code></a></li>
    {% endfor %}
</ul>
{% endif %}

{# Properties #}
<h2>Properties</h2>

{% if schema.properties %}
{% for name, prop in schema.properties.items() %}
{{ render_property(name, prop, name in (schema.required or []), 0) }}
{% endfor %}
{% else %}
<p>No properties defined in this schema.</p>
{% endif %}

{# Definitions #}
{% if schema.definitions or schema.get('$defs') %}
<h2>Definitions</h2>
{% set defs = schema.definitions or schema.get('$defs', {}) %}
{% for name, defn in defs.items() %}
<h3 id="def-{{ name }}">{{ name }} <a href="#def-{{ name }}" class="anchor-link">#</a></h3>
{% if defn.description %}
<p class="description">{{ defn.description }}</p>
{% endif %}
{% if defn.properties %}
{% for prop_name, prop in defn.properties.items() %}
{{ render_property(prop_name, prop, prop_name in (defn.required or []), 0) }}
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}
