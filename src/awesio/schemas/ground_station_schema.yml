$schema: http://json-schema.org/draft-07/schema#
$id: ground_station_schema
title: Ground Station Configuration Schema
description: >
  Schema for all AWES ground station configurations including pumping ground-gen,
  rotary ground-gen, and fly-gen systems.

type: object
required:
  - metadata
  - components

properties:
  metadata:
    type: object
    required:
      - name
      - description
      - note
      - awesIO_version
      - schema
      - ground_station_type
    properties:
      name:
        type: string
        description: Human-readable name for this configuration
      description:
        type: string
        description: Detailed description of the ground station system
      note:
        type: string
        description: Additional notes or caveats about this configuration
      awesIO_version:
        type: string
        description: Version of awesIO schema specification
      schema:
        type: string
        const: ground_station_schema.yml
        description: Reference to the schema file
      ground_station_type:
        type: string
        enum:
          - pumping_ground_gen
          - rotary_ground_gen
          - fly_gen
        description: Type of ground station system
    additionalProperties: false

  components:
    type: object
    properties:
      # Location (common)
      location:
        $ref: "#/definitions/location"
      
      # Drum winch (ground-gen only)
      drum_winch:
        $ref: "#/definitions/drum_winch"
      
      # Tensioning winch (fly-gen only)
      tensioning_winch:
        $ref: "#/definitions/tensioning_winch"
      
      # Generator (ground-gen only)
      generator:
        $ref: "#/definitions/generator"
      
      # Power receiving station (fly-gen only)
      power_receiving_station:
        $ref: "#/definitions/power_receiving_station"
      
      # Storage (common)
      storage:
        $ref: "#/definitions/storage"
      
      # Electrical efficiencies (common)
      electrical_efficiencies:
        $ref: "#/definitions/electrical_efficiencies"
      
      # Control system (common)
      control_system:
        $ref: "#/definitions/control_system"
      
      # Launch and recovery system (common)
      launch_recovery_system:
        $ref: "#/definitions/launch_recovery_system"
    
    additionalProperties: false

# Conditional validation based on ground_station_type
allOf:
  # Pumping ground-gen requires drum_winch and generator
  - if:
      properties:
        metadata:
          properties:
            ground_station_type:
              const: pumping_ground_gen
    then:
      properties:
        components:
          required:
            - drum_winch
            - generator
  
  # Rotary ground-gen requires generator
  - if:
      properties:
        metadata:
          properties:
            ground_station_type:
              const: rotary_ground_gen
    then:
      properties:
        components:
          required:
            - generator
  
  # Fly-gen may have tensioning_winch and power_receiving_station
  - if:
      properties:
        metadata:
          properties:
            ground_station_type:
              const: fly_gen
    then:
      properties:
        components:
          properties:
            tensioning_winch:
              $ref: "#/definitions/tensioning_winch"
            power_receiving_station:
              $ref: "#/definitions/power_receiving_station"

definitions:
  # Location definition
  location:
    type: object
    properties:
      latitude_deg:
        type: number
        minimum: -90
        maximum: 90
        description: Latitude in degrees
      longitude_deg:
        type: number
        minimum: -180
        maximum: 180
        description: Longitude in degrees
      altitude_m:
        type: number
        description: Altitude above sea level in meters
    additionalProperties: false

  # Drum winch (pumping ground-gen)
  drum_winch:
    type: object
    required:
      - max_tether_speed_m_s
      - max_tether_force_n
    properties:
      max_tether_speed_m_s:
        type: number
        minimum: 0
        description: Maximum tether reel-out/in speed in m/s
      max_tether_force_n:
        type: number
        minimum: 0
        description: Maximum tether force capacity in Newtons
      drum_diameter_m:
        type: number
        minimum: 0
        description: Drum diameter in meters
      drum_width_m:
        type: number
        minimum: 0
        description: Drum width in meters
      motor_power_kw:
        type: number
        minimum: 0
        description: Motor power rating in kilowatts
      gear_ratio:
        type: number
        minimum: 0
        description: Gearbox ratio
      efficiency:
        type: number
        minimum: 0
        maximum: 1
        description: Winch mechanical efficiency (0-1)
    additionalProperties: false

  # Tensioning winch (fly-gen)
  tensioning_winch:
    type: object
    required:
      - max_tether_force_n
    properties:
      max_tether_force_n:
        type: number
        minimum: 0
        description: Maximum tether force capacity in Newtons
      motor_power_kw:
        type: number
        minimum: 0
        description: Motor power rating in kilowatts
      efficiency:
        type: number
        minimum: 0
        maximum: 1
        description: Winch mechanical efficiency (0-1)
    additionalProperties: false

  # Generator (ground-gen systems)
  generator:
    type: object
    required:
      - type
      - rated_power_kw
    properties:
      type:
        type: string
        enum:
          - permanent_magnet_synchronous
          - induction
          - synchronous
          - dc
        description: Generator type
      rated_power_kw:
        type: number
        minimum: 0
        description: Rated power in kilowatts
      max_power_kw:
        type: number
        minimum: 0
        description: Maximum power in kilowatts
      rated_speed_rpm:
        type: number
        minimum: 0
        description: Rated speed in RPM
      efficiency:
        type: number
        minimum: 0
        maximum: 1
        description: Generator efficiency (0-1)
      voltage_v:
        type: number
        minimum: 0
        description: Output voltage in Volts
    additionalProperties: false

  # Power receiving station (fly-gen)
  power_receiving_station:
    type: object
    properties:
      max_power_kw:
        type: number
        minimum: 0
        description: Maximum power receiving capacity in kilowatts
      voltage_v:
        type: number
        minimum: 0
        description: Input voltage in Volts
      rectifier_type:
        type: string
        description: Rectifier type
      efficiency:
        type: number
        minimum: 0
        maximum: 1
        description: Power receiving efficiency (0-1)
    additionalProperties: false

  # Storage (common)
  storage:
    type: object
    required:
      - type
      - capacity_kwh
    properties:
      type:
        type: string
        enum:
          - battery_bank
          - supercapacitor
          - flywheel
          - none
        description: Storage type
      capacity_kwh:
        type: number
        minimum: 0
        description: Storage capacity in kilowatt-hours
      max_charge_rate_kw:
        type: number
        minimum: 0
        description: Maximum charge rate in kilowatts
      max_discharge_rate_kw:
        type: number
        minimum: 0
        description: Maximum discharge rate in kilowatts
      efficiency:
        type: number
        minimum: 0
        maximum: 1
        description: Round-trip efficiency (0-1)
      state_of_charge_initial:
        type: number
        minimum: 0
        maximum: 1
        description: Initial state of charge (0-1)
    additionalProperties: false

  # Electrical efficiencies
  electrical_efficiencies:
    type: object
    properties:
      power_electronics_efficiency:
        type: number
        minimum: 0
        maximum: 1
        description: Power electronics efficiency (0-1)
      transformer_efficiency:
        type: number
        minimum: 0
        maximum: 1
        description: Transformer efficiency (0-1)
      grid_connection_efficiency:
        type: number
        minimum: 0
        maximum: 1
        description: Grid connection efficiency (0-1)
    additionalProperties: false

  # Control system
  control_system:
    type: object
    properties:
      type:
        type: string
        description: Control system type
      control_bandwidth_hz:
        type: number
        minimum: 0
        description: Control bandwidth in Hz
      communication_protocol:
        type: string
        description: Communication protocol
    additionalProperties: false

  # Launch and recovery system
  launch_recovery_system:
    type: object
    properties:
      type:
        type: string
        enum:
          - mast
          - catapult
          - vertical_takeoff
          - ground_launch
        description: Launch/recovery system type
      max_wind_speed_m_s:
        type: number
        minimum: 0
        description: Maximum wind speed for launch/recovery in m/s
    additionalProperties: false

additionalProperties: false
