$schema: http://json-schema.org/draft-07/schema#
$id: airborne_schema
title: Airborne System Configuration Schema
description: >
  Schema for all AWES airborne system configurations including soft kites 
  (LEI, single skin, foil), hard wings (fixed wing, rigid, semi-rigid), 
  and various generation types (pumping ground-gen, fly-gen, rotary ground-gen).

type: object
required:
  - metadata
  - total_mass_kg
  - components

properties:
  metadata:
    type: object
    required:
      - name
      - description
      - note
      - awesIO_version
      - schema
      - airborne_type
      - generation_type
    properties:
      name:
        type: string
        description: Human-readable name for this configuration
      description:
        type: string
        description: Detailed description of the airborne system
      note:
        type: string
        description: Additional notes or caveats about this configuration
      awesIO_version:
        type: string
        description: Version of awesIO schema specification
      schema:
        type: string
        const: airborne_schema.yml
        description: Reference to the schema file
      airborne_type:
        type: string
        enum:
          - LEI_soft_kite
          - single_skin_soft_kite
          - foil_soft_kite
          - fixed_wing
          - rigid_hard_wing
          - semi_rigid_wing
        description: Type of airborne system
      generation_type:
        type: string
        enum:
          - pumping_ground_gen
          - fly_gen
          - rotary_ground_gen
        description: Power generation method
    additionalProperties: false

  total_mass_kg:
    type: number
    minimum: 0
    description: Total mass of the airborne system in kilograms

  components:
    type: object
    required:
      - wing
      - control_system
    properties:
      wing:
        $ref: "#/definitions/wing"
      bridle:
        $ref: "#/definitions/bridle"
      control_system:
        $ref: "#/definitions/control_system"
      power_train:
        $ref: "#/definitions/power_train"
    additionalProperties: false

# Conditional validation based on generation_type
allOf:
  # Fly-gen systems require power_train
  - if:
      properties:
        metadata:
          properties:
            generation_type:
              const: fly_gen
    then:
      properties:
        components:
          required:
            - wing
            - control_system
            - power_train

definitions:
  # Wing definition - using oneOf for type-based validation
  wing:
    type: object
    required:
      - type
      - mass_kg
      - aspect_ratio
    oneOf:
      # Soft kite wing types
      - properties:
          type:
            enum:
              - LEI_soft_kite
              - single_skin_soft_kite
              - foil_soft_kite
          mass_kg:
            type: number
            minimum: 0
            description: Wing mass in kilograms
          aspect_ratio:
            type: number
            minimum: 0
            description: Wing aspect ratio
          projected_surface_area_m2:
            type: number
            minimum: 0
            description: Projected wing surface area in square meters (for soft kites)
          bridle_height_m:
            type: number
            minimum: 0
            description: Bridle attachment height in meters
          flattening_factor:
            type: number
            minimum: 0
            maximum: 1
            description: Flattening factor for soft kite shape (0-1)
          lift_coefficient_reel_out:
            type: number
            description: Lift coefficient during reel-out phase
          drag_coefficient_reel_out:
            type: number
            minimum: 0
            description: Drag coefficient during reel-out phase
          lift_coefficient_reel_in:
            type: number
            description: Lift coefficient during reel-in phase
          drag_coefficient_reel_in:
            type: number
            minimum: 0
            description: Drag coefficient during reel-in phase
          lift_polars:
            type: array
            items:
              type: object
              required:
                - angle_of_attack_deg
                - lift_coefficient
              properties:
                angle_of_attack_deg:
                  type: number
                lift_coefficient:
                  type: number
              additionalProperties: false
            description: Lift polar data points
          drag_polars:
            type: array
            items:
              type: object
              required:
                - angle_of_attack_deg
                - drag_coefficient
              properties:
                angle_of_attack_deg:
                  type: number
                drag_coefficient:
                  type: number
              additionalProperties: false
            description: Drag polar data points
          geometry:
            $ref: "#/definitions/wing_geometry"
          material_properties:
            $ref: "#/definitions/material_properties"
        required:
          - type
          - mass_kg
          - aspect_ratio
          - projected_surface_area_m2
        additionalProperties: false
      
      # Hard wing types (fixed, rigid, semi-rigid)
      - properties:
          type:
            enum:
              - fixed_wing
              - rigid_hard_wing
              - semi_rigid_wing
          mass_kg:
            type: number
            minimum: 0
            description: Wing mass in kilograms
          aspect_ratio:
            type: number
            minimum: 0
            description: Wing aspect ratio
          wing_surface_area_m2:
            type: number
            minimum: 0
            description: Wing surface area in square meters (for hard wings)
          lift_coefficient_design:
            type: number
            description: Design lift coefficient
          drag_coefficient_design:
            type: number
            minimum: 0
            description: Design drag coefficient
          max_lift_coefficient:
            type: number
            description: Maximum lift coefficient
          oswald_efficiency:
            type: number
            minimum: 0
            maximum: 1
            description: Oswald efficiency factor
          lift_polars:
            type: array
            items:
              type: object
              required:
                - angle_of_attack_deg
                - lift_coefficient
              properties:
                angle_of_attack_deg:
                  type: number
                lift_coefficient:
                  type: number
              additionalProperties: false
            description: Lift polar data points
          drag_polars:
            type: array
            items:
              type: object
              required:
                - angle_of_attack_deg
                - drag_coefficient
              properties:
                angle_of_attack_deg:
                  type: number
                drag_coefficient:
                  type: number
              additionalProperties: false
            description: Drag polar data points
          geometry:
            $ref: "#/definitions/wing_geometry"
          material_properties:
            $ref: "#/definitions/material_properties"
        required:
          - type
          - mass_kg
          - aspect_ratio
          - wing_surface_area_m2
        additionalProperties: false

  # Wing geometry
  wing_geometry:
    type: object
    properties:
      span_m:
        type: number
        minimum: 0
        description: Wing span in meters
      chord_m:
        type: number
        minimum: 0
        description: Mean chord in meters
      root_chord_m:
        type: number
        minimum: 0
        description: Root chord in meters
      tip_chord_m:
        type: number
        minimum: 0
        description: Tip chord in meters
      sweep_angle_deg:
        type: number
        description: Sweep angle in degrees
      dihedral_angle_deg:
        type: number
        description: Dihedral angle in degrees
      twist_deg:
        type: number
        description: Wing twist in degrees
    additionalProperties: false

  # Material properties for soft kites
  material_properties:
    type: object
    properties:
      canopy_material:
        type: string
        description: Canopy material type
      leading_edge_material:
        type: string
        description: Leading edge material type
      strut_material:
        type: string
        description: Strut material type
      skin_material:
        type: string
        description: Skin material type
      structural_material:
        type: string
        description: Structural material type
    additionalProperties: false

  # Bridle definition
  bridle:
    type: object
    required:
      - type
      - mass_kg
    properties:
      type:
        type: string
        enum:
          - LEI_soft_kite_bridle
          - foil_kite_bridle
          - single_skin_bridle
          - hard_wing_bridle
        description: Bridle type
      mass_kg:
        type: number
        minimum: 0
        description: Bridle mass in kilograms
      number_of_lines:
        type: integer
        minimum: 1
        description: Number of bridle lines
      line_diameter_mm:
        type: number
        minimum: 0
        description: Bridle line diameter in millimeters
      line_material:
        type: string
        description: Bridle line material
      breaking_strength_n:
        type: number
        minimum: 0
        description: Breaking strength per line in Newtons
    additionalProperties: false

  # Control system definition using oneOf for type-based validation
  control_system:
    type: object
    required:
      - type
    oneOf:
      # KCU for soft kites
      - properties:
          type:
            const: kcu
          mass_kg:
            type: number
            minimum: 0
            description: Control system mass in kilograms
          drag_coefficient:
            type: number
            minimum: 0
            description: Control system drag coefficient
          frontal_area_m2:
            type: number
            minimum: 0
            description: Frontal area in square meters
          power_consumption_w:
            type: number
            minimum: 0
            description: Power consumption in Watts
          control_bandwidth_hz:
            type: number
            minimum: 0
            description: Control bandwidth in Hz
        required:
          - type
          - mass_kg
          - drag_coefficient
          - frontal_area_m2
        additionalProperties: false
      
      # Flight controller for hard wings
      - properties:
          type:
            const: flight_controller
          mass_kg:
            type: number
            minimum: 0
            description: Control system mass in kilograms
          power_consumption_w:
            type: number
            minimum: 0
            description: Power consumption in Watts
          control_bandwidth_hz:
            type: number
            minimum: 0
            description: Control bandwidth in Hz
          aileron_authority_deg:
            type: number
            description: Maximum aileron deflection in degrees
          elevator_authority_deg:
            type: number
            description: Maximum elevator deflection in degrees
          rudder_authority_deg:
            type: number
            description: Maximum rudder deflection in degrees
        required:
          - type
        additionalProperties: false
      
      # Manual control
      - properties:
          type:
            const: manual_control
          description:
            type: string
        required:
          - type
        additionalProperties: false
      
      # Autopilot
      - properties:
          type:
            const: autopilot
          mass_kg:
            type: number
            minimum: 0
            description: Control system mass in kilograms
          power_consumption_w:
            type: number
            minimum: 0
            description: Power consumption in Watts
          control_bandwidth_hz:
            type: number
            minimum: 0
            description: Control bandwidth in Hz
        required:
          - type
        additionalProperties: false

  # Power train for fly-gen systems
  power_train:
    type: object
    required:
      - type
      - number_of_turbines
    properties:
      type:
        type: string
        enum:
          - onboard_turbine
          - propeller_generator
        description: Power train type
      number_of_turbines:
        type: integer
        minimum: 1
        description: Number of onboard turbines
      rotor_diameter_m:
        type: number
        minimum: 0
        description: Rotor diameter in meters
      rated_power_kw:
        type: number
        minimum: 0
        description: Rated power per turbine in kilowatts
      generator_type:
        type: string
        description: Generator type
      generator_efficiency:
        type: number
        minimum: 0
        maximum: 1
        description: Generator efficiency (0-1)
      cut_in_speed_m_s:
        type: number
        minimum: 0
        description: Cut-in wind speed in m/s
      cut_out_speed_m_s:
        type: number
        minimum: 0
        description: Cut-out wind speed in m/s
    additionalProperties: false

additionalProperties: false
