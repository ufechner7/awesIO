$schema: http://json-schema.org/draft-07/schema#
$id: wind_resource_schema
title: Wind Resource Data Schema
description: Schema for wind resource clustering data including location, time range, and cluster definitions

type: object
required:
  - metadata
  - altitudes
  - wind_speed_bins
  - clusters
  - probability_matrix

properties:
  metadata:
    type: object
    required:
      - name
      - description
      - note
      - awesIO_version
      - schema
      - n_clusters
      - n_wind_speed_bins
      - reference_height_m
      - total_samples
      - wind_speed_range_m_s
      - data_source
      - altitude_range_m
    properties:
      name:
        type: string
        description: Human-readable name for this wind resource dataset
      description:
        type: string
        description: Detailed description of the wind resource data
      note:
        type: string
        description: Additional notes or caveats about this data
      awesIO_version:
        type: string
        description: Version of awesIO schema specification
      schema:
        type: string
        const: wind_resource_schema.yml
        description: Reference to the schema file
      n_clusters:
        type: integer
        minimum: 1
        description: Number of wind profile clusters
      n_wind_speed_bins:
        type: integer
        minimum: 1
        description: Number of wind speed bins
      n_wind_direction_bins:
        type: integer
        minimum: 1
        description: Number of wind direction bins
      wind_direction_bin_width_deg:
        type: number
        minimum: 0
        maximum: 360
        description: Wind direction bin width in degrees
      reference_height_m:
        type: number
        description: Reference height in meters
      total_samples:
        type: integer
        minimum: 0
        description: Total number of samples in dataset
      wind_speed_range_m_s:
        type: array
        items:
          type: number
        minItems: 2
        maxItems: 2
        description: Wind speed range [min, max] in m/s
      data_source:
        type: string
        description: Source of wind data (e.g., ERA5, MERRA2)
      location:
        type: object
        properties:
          latitude:
            type: number
            minimum: -90
            maximum: 90
          longitude:
            type: number
            minimum: -180
            maximum: 180
        description: Geographic location of the wind resource
      time_range:
        type: object
        properties:
          start_year:
            type: integer
          end_year:
            type: integer
          years:
            type: array
            items:
              type: integer
          years_included:
            type: array
            items:
              type: integer
          months_included:
            oneOf:
              - type: string
                enum: ["all"]
              - type: array
                items:
                  type: integer
                  minimum: 1
                  maximum: 12
        description: Time range of the wind data
      altitude_range_m:
        type: array
        items:
          type: number
        minItems: 2
        maxItems: 2
        description: Altitude range [min, max] in meters
      clustering_parameters:
        type: object
        properties:
          n_pcs:
            type: integer
          explained_variance:
            type: array
            items:
              type: number
          explained_variance_ratio:
            type: number
          method:
            type: string
          n_init:
            type: integer
          max_iter:
            type: integer
          random_state:
            type: integer
          fit_inertia:
            type: number
        description: Parameters used for wind profile clustering
      time_created:
        type: string
        description: Timestamp of data creation
    additionalProperties: true
    additionalProperties: true

  altitudes:
    type: array
    items:
      type: number
    minItems: 1
  wind_speed_bins:
    type: object
    properties:
      bin_edges_m_s:
        type: array
        items:
          type: number
      bin_centers_m_s:
        type: array
        items:
          type: number
    required:
      - bin_edges_m_s
      - bin_centers_m_s
  wind_direction_bins:
    type: object
    properties:
      bin_edges_deg:
        type: array
        items:
          type: number
          minimum: 0
          maximum: 360
      bin_centers_deg:
        type: array
        items:
          type: number
          minimum: 0
          maximum: 360
    required:
      - bin_edges_deg
      - bin_centers_deg
  clusters:
    type: array
    items:
      type: object
      properties:
        id:
          type: integer
          minimum: 1
        u_normalized:
          type: array
          items:
            type: number
        v_normalized:
          type: array
          items:
            type: number
      required:
        - id
        - u_normalized
        - v_normalized
    minItems: 1
  probability_matrix:
    type: object
    properties:
      description:
        type: string
      dimensions:
        type: string
      data:
        oneOf:
          - type: array
            items:
              type: array
              items:
                type: number
            description: 2D matrix (n_clusters x n_wind_speed_bins)
          - type: array
            items:
              type: array
              items:
                type: array
                items:
                  type: number
            description: 3D matrix (n_clusters x n_wind_speed_bins x n_wind_direction_bins)
    required:
      - description
      - dimensions
      - data

  # Custom validation notes:
  # - u_normalized and v_normalized arrays within each cluster must have the same length
  # - u_normalized and v_normalized must have the same length as altitudes array
  # - cluster id values must be unique and consecutive (1, 2, 3, ...)
  # - probability_matrix data dimensions must match n_clusters x n_wind_speed_bins or n_clusters x n_wind_speed_bins x n_wind_direction_bins
  # - bin_edges_m_s must have exactly n_wind_speed_bins + 1 elements
  # - bin_centers_m_s must have exactly n_wind_speed_bins elements
  # - Sum of probabilities in probability_matrix should equal 1.0 (within tolerance)

additionalProperties: false