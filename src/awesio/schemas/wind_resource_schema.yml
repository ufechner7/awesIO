$schema: http://json-schema.org/draft-07/schema#
$id: wind_resource_schema
title: Wind Resource Data Schema
description: >
  Schema for wind resource clustering data including location, time range,
  and cluster definitions.

type: object
required:
  - metadata
  - altitudes
  - wind_speed_bins
  - clusters
  - probability_matrix

properties:
  metadata:
    type: object
    required:
      - name
      - description
      - note
      - awesIO_version
      - schema
      - n_clusters
      - n_wind_speed_bins
      - reference_height_m
      - total_samples
      - wind_speed_range_m_s
      - data_source
      - altitude_range_m
    properties:
      name:
        type: string
        description: Human-readable name for this wind resource dataset
      description:
        type: string
        description: Detailed description of the wind resource data
      note:
        type: string
        description: Additional notes or caveats about this data
      awesIO_version:
        type: string
        description: Version of awesIO schema specification
      schema:
        type: string
        const: wind_resource_schema.yml
        description: Reference to the schema file
      n_clusters:
        type: integer
        minimum: 1
        description: Number of wind profile clusters
      n_wind_speed_bins:
        type: integer
        minimum: 1
        description: Number of wind speed bins
      n_wind_direction_bins:
        type: integer
        minimum: 1
        description: Number of wind direction bins
      wind_direction_bin_width_deg:
        type: number
        minimum: 0
        maximum: 360
        description: Wind direction bin width in degrees
      reference_height_m:
        type: number
        description: Reference height in meters
      total_samples:
        type: integer
        minimum: 0
        description: Total number of samples in dataset
      wind_speed_range_m_s:
        type: array
        items:
          type: number
        minItems: 2
        maxItems: 2
        description: Wind speed range [min, max] in m/s
      data_source:
        type: string
        description: Source of wind data (e.g., ERA5, MERRA2)
      location:
        type: object
        properties:
          latitude:
            type: number
            minimum: -90
            maximum: 90
            description: Latitude in degrees
          longitude:
            type: number
            minimum: -180
            maximum: 180
            description: Longitude in degrees
        additionalProperties: false
        description: Geographic location of the wind resource
      time_range:
        type: object
        properties:
          start_year:
            type: integer
            description: Start year
          end_year:
            type: integer
            description: End year
          years:
            type: array
            items:
              type: integer
            description: List of years included
          years_included:
            type: array
            items:
              type: integer
            description: List of years included
          months_included:
            oneOf:
              - type: string
                enum: ["all"]
              - type: array
                items:
                  type: integer
                  minimum: 1
                  maximum: 12
            description: Months included in data
        additionalProperties: false
        description: Time range of the wind data
      altitude_range_m:
        type: array
        items:
          type: number
        minItems: 2
        maxItems: 2
        description: Altitude range [min, max] in meters
      clustering_parameters:
        type: object
        properties:
          n_pcs:
            type: integer
            description: Number of principal components
          explained_variance:
            type: array
            items:
              type: number
            description: Explained variance per PC
          explained_variance_ratio:
            type: number
            description: Total explained variance ratio
          method:
            type: string
            description: Clustering method
          n_init:
            type: integer
            description: Number of initializations
          max_iter:
            type: integer
            description: Maximum iterations
          random_state:
            type: integer
            description: Random state for reproducibility
          fit_inertia:
            type: number
            description: Fit inertia value
        additionalProperties: false
        description: Parameters used for wind profile clustering
      time_created:
        type: string
        description: Timestamp of data creation
    additionalProperties: true

  altitudes:
    type: array
    items:
      type: number
    minItems: 1
    description: Array of altitudes in meters

  wind_speed_bins:
    type: object
    required:
      - bin_edges_m_s
      - bin_centers_m_s
    properties:
      bin_edges_m_s:
        type: array
        items:
          type: number
        description: Wind speed bin edges in m/s
      bin_centers_m_s:
        type: array
        items:
          type: number
        description: Wind speed bin centers in m/s
    additionalProperties: false
    description: Wind speed binning information

  wind_direction_bins:
    type: object
    required:
      - bin_edges_deg
      - bin_centers_deg
    properties:
      bin_edges_deg:
        type: array
        items:
          type: number
          minimum: 0
          maximum: 360
        description: Wind direction bin edges in degrees
      bin_centers_deg:
        type: array
        items:
          type: number
          minimum: 0
          maximum: 360
        description: Wind direction bin centers in degrees
    additionalProperties: false
    description: Wind direction binning information

  clusters:
    type: array
    items:
      type: object
      required:
        - id
        - u_normalized
        - v_normalized
      properties:
        id:
          type: integer
          minimum: 1
          description: Cluster identifier
        u_normalized:
          type: array
          items:
            type: number
          minItems: 1
          description: Normalized u-component of wind speed at each altitude
        v_normalized:
          type: array
          items:
            type: number
          minItems: 1
          description: Normalized v-component of wind speed at each altitude
        speed_ratio_at_reference_height:
          type: number
          minimum: 0
          description: Speed ratio at reference height
        probability:
          type: number
          minimum: 0
          maximum: 1
          description: Overall probability of this cluster
        sample_count:
          type: integer
          minimum: 0
          description: Number of samples in this cluster
      additionalProperties: false
    minItems: 1
    description: Array of wind profile clusters

  probability_matrix:
    oneOf:
      - type: object
        required:
          - data
        properties:
          description:
            type: string
            description: Description of the probability matrix
          dimensions:
            type: string
            description: Dimensions description
          data:
            type: array
            items:
              type: array
              items:
                type: number
                minimum: 0
              minItems: 1
            minItems: 1
            description: >
              2D probability matrix with dimensions [n_clusters x n_wind_speed_bins].
              Each row represents a cluster, each column represents a wind speed bin.
              Values are probabilities (should sum to 1.0).
        additionalProperties: false
        description: Probability matrix for cluster occurrence at each wind speed bin (no directional information)
      - type: object
        required:
          - data
        properties:
          description:
            type: string
            description: Description of the probability matrix
          dimensions:
            type: string
            description: Dimensions description
          data:
            type: array
            items:
              type: array
              items:
                type: array
                items:
                  type: number
                  minimum: 0
                minItems: 1
              minItems: 1
            minItems: 1
            description: >
              3D probability matrix with dimensions [n_clusters x n_wind_speed_bins x n_wind_direction_bins].
              Each cluster has a matrix where rows represent wind speed bins and columns represent direction bins.
              Values are probabilities (should sum to 1.0).
        additionalProperties: false
        description: Probability matrix for cluster occurrence at each wind speed and direction bin
    description: Probability matrix for cluster occurrence (either 2D or 3D depending on directional data)

additionalProperties: false
