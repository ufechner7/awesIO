$schema: http://json-schema.org/draft-07/schema#
$id: power_curves_schema
title: Power Curves Data Schema
description: Schema for AWES power curves data including cluster-specific power outputs

type: object
required:
  - metadata
  - altitudes_m
  - reference_wind_speeds_m_s
  - power_curves

properties:
  metadata:
    type: object
    required:
      - name
      - description
      - note
      - awesIO_version
      - schema
      - time_created
      - model_config
    properties:
      name:
        type: string
        description: Human-readable name for this power curves dataset
      description:
        type: string
        description: Detailed description of the power curves data
      note:
        type: string
        description: Additional notes or caveats about this data
      awesIO_version:
        type: string
        description: Version of awesIO schema specification
      schema:
        type: string
        const: power_curves_schema.yml
        description: Reference to the schema file
      time_created:
        type: string
        description: Timestamp of data creation
      model_config:
        type: object
        properties:
          wing_area_m2:
            type: number
            minimum: 0
          nominal_power_w:
            type: number
            minimum: 0
          nominal_tether_force_n:
            type: number
            minimum: 0
          cut_in_wind_speed_m_s:
            type: number
            minimum: 0
          cut_out_wind_speed_m_s:
            type: number
            minimum: 0
          operating_altitude_m:
            type: number
            minimum: 0
          tether_length_operational_m:
            type: number
            minimum: 0
        required:
          - wing_area_m2
          - nominal_power_w
          - nominal_tether_force_n
          - cut_in_wind_speed_m_s
          - cut_out_wind_speed_m_s
          - operating_altitude_m
          - tether_length_operational_m
        additionalProperties: false
      wind_resource:
        type: object
        properties:
          n_clusters:
            type: integer
            minimum: 1
          reference_height_m:
            type: number
            minimum: 0
          location:
            type: object
            properties:
              latitude:
                type: number
                minimum: -90
                maximum: 90
              longitude:
                type: number
                minimum: -180
                maximum: 180
            required:
              - latitude
              - longitude
            additionalProperties: false
          data_source:
            type: string
        additionalProperties: false
    additionalProperties: true
  altitudes_m:
    type: array
    items:
      type: number
      minimum: 0
    minItems: 1
    uniqueItems: true
  reference_wind_speeds_m_s:
    type: array
    items:
      type: number
      minimum: 0
    minItems: 1
    uniqueItems: true
  power_curves:
    type: array
    items:
      type: object
      properties:
        profile_id:
          type: integer
          minimum: 1
        speed_ratio_at_operating_altitude:
          type: number
          minimum: 0
        u_normalized:
          type: array
          items:
            type: number
          minItems: 1
        v_normalized:
          type: array
          items:
            type: number
          minItems: 1
        probability_weight:
          type: number
          minimum: 0
          maximum: 1
        cycle_power_w:
          type: array
          items:
            type: number
            minimum: 0
          minItems: 1
        reel_out_power_w:
          type: array
          items:
            type: number
            minimum: 0
          minItems: 1
        reel_in_power_w:
          type: array
          items:
            type: number
          minItems: 1
        reel_out_time_s:
          type: array
          items:
            type: number
            minimum: 0
          minItems: 1
        reel_in_time_s:
          type: array
          items:
            type: number
            minimum: 0
          minItems: 1
        cycle_time_s:
          type: array
          items:
            type: number
            minimum: 0
          minItems: 1
      required:
        - u_normalized
        - v_normalized
        - cycle_power_w
      additionalProperties: false
    minItems: 1

  # Custom validation notes:
  # - All arrays within each power_curve item must have the same length
  # - u_normalized and v_normalized must have the same length as altitudes_m
  # - All power and time arrays must have the same length as reference_wind_speeds_m_s
  # - profile_id values must be unique across all power_curves
  # - Sum of probability_weight across all power_curves should equal 1.0 (within tolerance)

additionalProperties: false